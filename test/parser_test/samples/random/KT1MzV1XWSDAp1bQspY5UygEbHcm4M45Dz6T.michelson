parameter (or (unit %callGetReserves) (pair %recieveReserves (nat %token) (nat %xtz))); storage (pair (address %MAG) (pair (nat %tez_pool) (nat %token_pool))); code { CAST (pair (or unit (pair nat nat)) (pair address (pair nat nat))) ; UNPAIR ; IF_LEFT { DROP ; DUP ; CAR ; CONTRACT %getReserves (contract (pair nat nat)) ; IF_NONE { PUSH int 14 ; FAILWITH } {} ; NIL operation ; SWAP ; PUSH mutez 0 ; SELF_ADDRESS ; CONTRACT %recieveReserves (pair nat nat) ; IF_NONE { PUSH int 13 ; FAILWITH } {} ; TRANSFER_TOKENS ; CONS } { DUP ; DUG 2 ; CDR ; UPDATE 3 ; SWAP ; CAR ; UPDATE 4 ; NIL operation } ; PAIR }