parameter (pair (pair (address %address_from) (address %address_to)) (nat %value)); storage (pair (big_map %tokens address nat) (nat %total_supply)); code { UNPAIR ; PUSH mutez 0 ; AMOUNT ; COMPARE ; NEQ ; IF { DROP 2 ; PUSH string "TezAmountNotZero" ; FAILWITH } { SWAP ; DUP ; DUG 2 ; CAR ; SWAP ; DUP ; DUG 2 ; CAR ; CAR ; GET ; IF_NONE { PUSH nat 0 } {} ; SWAP ; DUP ; DUG 2 ; CDR ; SWAP ; DUP ; DUG 2 ; COMPARE ; LT ; IF { DROP 3 ; PUSH string "Not Enough Balance" ; FAILWITH } { DUP 3 ; CAR ; DUP 3 ; CDR ; DIG 2 ; SUB ; ABS ; SOME ; DUP 3 ; CAR ; CAR ; UPDATE ; SWAP ; DUP ; DUG 2 ; CDR ; DUP 4 ; CAR ; DUP 4 ; CAR ; CDR ; GET ; IF_NONE { PUSH nat 0 } {} ; ADD ; SOME ; DIG 2 ; CAR ; CDR ; UPDATE ; SWAP ; CDR ; SWAP ; PAIR ; NIL operation ; PAIR } } }