parameter (or (or (lambda %a unit (pair (list operation) (pair (pair (address %a) (nat %b)) (address %q)))) (nat %q)) (nat %s)); storage (pair (pair (address %a) (nat %b)) (address %q)); code { UNPAIR ; IF_LEFT { IF_LEFT { SWAP ; CAR ; CAR ; SENDER ; COMPARE ; EQ ; IF {} { PUSH string "1" ; FAILWITH } ; UNIT ; EXEC } { SWAP ; SELF_ADDRESS ; SENDER ; COMPARE ; EQ ; IF {} { PUSH string "2" ; FAILWITH } ; DUP ; CDR ; CONTRACT %tokenToTezPayment (pair (pair (nat %amount) (nat %min_out)) (address %receiver)) ; IF_NONE { PUSH string "3" ; FAILWITH } {} ; PUSH mutez 0 ; DUP 3 ; CAR ; CAR ; DIG 4 ; DUP 5 ; CAR ; CDR ; PAIR ; PAIR ; TRANSFER_TOKENS ; SWAP ; NIL operation ; DIG 2 ; CONS ; PAIR } } { SWAP ; DUP ; CDR ; DUG 2 ; CAR ; CAR ; PAIR ; PAIR ; NIL operation ; PAIR } }